# 로봇 하드웨어 조립 후 작업 가이드 (v0.16 기준)

이 문서는 모터와 바퀴 등 모든 하드웨어 조립이 완료된 후, 실제 로봇의 구동을 테스트하고 SLAM 및 내비게이션을 실행하기 위한 소프트웨어 설정 및 실행 방법을 안내합니다.

## 1. 필수 준비 사항

로봇을 구동하기 전에 다음 준비가 반드시 완료되어야 합니다.

*   **하드웨어 조립**: 라즈베리파이, OpenCR 보드, Dynamixel XL-430 모터 (4개), 바퀴, 라이다, 카메라 등 모든 하드웨어가 물리적으로 조립되고 연결된 상태여야 합니다.
*   **OpenCR 펌웨어 업로드**: **가장 중요한 단계입니다.** OpenCR 보드에 `turtlebot3_core.ino` 펌웨어를 업로드해야 합니다. 이 펌웨어는 OpenCR 보드가 ROS2와 통신할 수 있도록 해주는 핵심 소프트웨어입니다.
    *   **주의:** 펌웨어 코드에서 통신 속도(Baudrate)가 **1000000**으로 설정되어 있는지 확인해야 합니다. 이는 우리 런치 파일의 `slampibot.yaml` 설정과 일치해야 합니다.
*   **네트워크 설정**: 로봇의 라즈베리파이와 로봇을 제어할 원격 PC가 동일한 네트워크에 연결되어 있어야 합니다.

## 2. 라즈베리파이 소프트웨어 설정

1.  **ROS2 및 관련 패키지 설치**: 라즈베리파이에 ROS2 Humble, `turtlebot3_node`, `rplidar_ros` 등 필요한 모든 패키지가 설치되어 있어야 합니다.
2.  **워크스페이스 클론 및 빌드**: 이 프로젝트(`slampibot_gazebo`)를 라즈베리파이의 ROS2 워크스페이스(`ros2_ws/src`)에 클론하고, `colcon build` 명령으로 전체 워크스페이스를 빌드합니다.
    ```bash
    cd ~/ros2_ws
    colcon build
    ```

## 3. 실행 및 테스트 가이드

모든 준비가 완료되면, 다음 단계에 따라 기능을 테스트할 수 있습니다. 각 런치 파일은 로봇(라즈베리파이)에서 실행합니다. RViz나 `rqt_robot_steering`과 같은 GUI 도구는 원격 PC에서 실행하여 로봇을 제어하고 모니터링합니다.

### 1단계: 기본 동작 및 키보드 조종 테스트

*   **목적**: 모터가 정상적으로 작동하는지, 로봇이 의도한 대로 움직이는지 확인하는 초기 하드웨어 테스트입니다.
*   **실행 명령어 (라즈베리파이 터미널):**
    ```bash
    source ~/ros2_ws/install/setup.bash
    ros2 launch slampibot_gazebo real_robot.launch.py
    ```
*   **예상 결과**:
    *   명령 실행 시, **새로운 터미널 창이 나타나며** 키보드 조종 노드(`teleop_keyboard`)가 실행됩니다.
    *   해당 터미널 창에서 `w, a, s, d, x` 키를 사용하여 로봇을 직접 제어할 수 있습니다.
    *   로봇이 키보드 입력에 따라 정상적으로 움직인다면, `turtlebot3_node`와 OpenCR 펌웨어 간의 통신이 성공적으로 이루어진 것입니다.
    *   (원격 PC) `rviz2`를 실행하여 로봇 모델이 올바르게 표시되는지, TF가 정상적으로 발행되는지 확인할 수 있습니다.

### 2단계: SLAM (지도 생성)

*   **목적**: 로봇을 조종하여 주변 환경의 지도를 생성하고 저장합니다.
*   **실행 명령어 (라즈베리파이 터미널):**
    ```bash
    source ~/ros2_ws/install/setup.bash
    ros2 launch slampibot_gazebo real_cartographer.launch.py
    ```
*   **작업 순서**:
    1.  위 명령어로 SLAM 관련 노드들을 모두 실행합니다.
    2.  **원격 PC**에서 `rqt_robot_steering`을 실행하여 로봇을 부드럽게 조종하며 지도 영역을 탐색합니다.
        ```bash
        rqt_robot_steering
        ```
    3.  **원격 PC**에서 `rviz2`를 실행하고, `/map` 토픽을 추가하여 실시간으로 지도가 만들어지는 과정을 확인합니다.
    4.  지도가 완성되면, **원격 PC의 새 터미널**에서 아래 명령어를 실행하여 지도를 저장합니다. (`~/map`은 원하는 경로와 파일 이름으로 변경 가능)
        ```bash
        ros2 run nav2_map_server map_saver_cli -f ~/map
        ```

### 3단계: 내비게이션 (자율 주행)

*   **목적**: 2단계에서 생성하고 저장한 지도를 이용해 로봇이 자율적으로 목표 지점까지 주행하도록 합니다.
*   **사전 준비**: `maps` 폴더에 `spb_map.yaml`과 `spb_map.pgm` 파일이 저장되어 있어야 합니다. (이름이 다르다면 `real_nav.launch.py` 파일 수정 필요)
*   **실행 명령어 (라즈베리파이 터미널):**
    ```bash
    source ~/ros2_ws/install/setup.bash
    ros2 launch slampibot_gazebo real_nav.launch.py
    ```
*   **작업 순서**:
    1.  위 명령어로 내비게이션 스택을 포함한 모든 노드를 실행합니다.
    2.  **원격 PC**에서 `rviz2`를 실행합니다. 로봇이 지도 상에 나타나고, 라이다 센서 데이터가 지도와 일치하는 것을 확인합니다.
    3.  RViz의 `2D Pose Estimate` 툴을 사용하여 로봇의 현재 위치와 방향을 지도 상에 지정해줍니다. (초기 위치 추정)
    4.  RViz의 `Nav2 Goal` 툴을 사용하여 목표 지점을 클릭하면, 로봇이 해당 지점까지 자율적으로 경로를 계획하고 주행합니다.
    5.  `waypoint_commander_node`가 함께 실행되므로, 웹 인터페이스를 통한 웨이포인트 주행도 테스트할 수 있습니다.
